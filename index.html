<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="cake.css">
    <link rel="stylesheet" href="block.css">
    <link rel="stylesheet" href="fireworks.css">
    <title>Document</title>
</head>
<body>
    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
        <a href="letter.html" class="btn btn-success btn-lg">Next</a>
    </div>
    <div class="greet">
        <svg viewBox="0 0 500 500">
            <path id="curve" d="M73.2,148.6c4-6.1,65.5-96.8,178.6-95.6c111.3,1.2,170.8,90.3,175.1,97" />
            <text width="500">
                <textPath id="birthdayText" xlink:href="#curve" startOffset="10px">
                    Happy Birthday! Sir Dino
                </textPath>
            </text>
          
        </svg> 
    </div>
    <div class="cake" onclick="toggleAudio()">
        <div class="plate"></div>
        <div class="layer layer-bottom"></div>
        <div class="layer layer-middle"></div>
        <div class="layer layer-top"></div>
        <div class="icing"></div>
        <div class="drip drip1"></div>
        <div class="drip drip2"></div>
        <div class="drip drip3"></div>
        <div class="candle">
            <div class="flame"></div>
        </div>
    </div>

    <div class="fireworkDiv"></div>

    <audio id="myAudio">
        <source src="happy-birthday-155461.mp3" type="audio/mpeg">
    </audio>
    <audio id="endAudio" src="greet.mp3"></audio>

<script src="https://cdn.jsdelivr.net/npm/fireworks-js@latest/dist/fireworks.js"></script>
<script src="fireworks.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tsparticles/confetti@3.0.3/tsparticles.confetti.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script>
     document.body.scrollTop = document.documentElement.scrollTop = 0;
</script>
<script>
    function adjustTextPathOffset() {
    const textPath = document.getElementById('birthdayText');
    if (window.innerWidth <= 768) {
        
        textPath.setAttribute('startOffset', '36px'); 
    } else {
        
        textPath.setAttribute('startOffset', '10px'); 
    }
}

// Run on window resize and on page load
window.addEventListener('resize', adjustTextPathOffset);
window.addEventListener('load', adjustTextPathOffset);

</script>

<script>
    const cakejs = document.querySelector(".cake");
    const images = [
        'images/image1.jpg',
        'images/image2.jpg',
        'images/image3.jpg',
        'images/image4.jpg',
        'images/image10.jpg',
        'images/image11.jpg',
        'images/image12.jpg',
        'images/image13.jpg',
        'images/image14.jpg',
        'images/image15.jpg',
        'images/image16.jpg',
        'images/image17.jpg',
        'images/image18.jpg',
        'images/image19.jpg',
        'images/image20.jpg',
        'images/image21.jpg',
        'images/image22.jpg',
        'images/image23.jpg',
        'images/image24.jpg',
        'images/image25.jpg',
        'images/image26.jpg',
        'images/image27.jpg',
        'images/image28.jpg',
        'images/image29.jpg',
        'images/image30.jpg',
        'images/image32.jpg',
        'images/image33.jpg',
        'images/image34.jpg',
        'images/image35.jpg',
        'images/image36.jpg',
        'images/image37.jpg',
        'images/image38.jpg',
        'images/image39.jpg',
        'images/image40.jpg',
        'images/image41.jpg'
    ];

    var audioElement = document.getElementById("myAudio");
        var endAudioElement = document.getElementById("endAudio");
        var confettiInterval, imageInterval, imageTimeout;

        function getRandomPosition() {
            const x = Math.floor(Math.random() * (window.innerWidth - 200)); 
            const y = Math.floor(Math.random() * (window.innerHeight - 200)); 
            return { x, y };
        }

        function fadeInOutRandomImage() {
            const img = document.createElement('img');
            img.src = images[Math.floor(Math.random() * images.length)]; 
            img.className = 'random-image';

            const { x, y } = getRandomPosition();
            img.style.left = `${x}px`;
            img.style.top = `${y}px`;

            document.body.appendChild(img);

            img.style.display = 'block';
            img.style.opacity = 0;
            let opacity = 0;

            const fadeIn = setInterval(() => {
                opacity += 0.05;
                img.style.opacity = opacity;
                if (opacity >= 1) {
                    clearInterval(fadeIn);

                    setTimeout(() => {
                        const fadeOut = setInterval(() => {
                            opacity -= 0.05;
                            img.style.opacity = opacity;
                            if (opacity <= 0) {
                                clearInterval(fadeOut);
                                img.remove();
                            }
                        }, 50);
                    }, 2000); 
                }
            }, 50);
        }

        const fireConfetti = () => {
            confetti({
                particleCount: 460,
                spread: 220,
                origin: { x: 0.2, y: 0.7 },
            });

            confetti({
                particleCount: 460,
                spread: 220,
                origin: { x: 0.8, y: 0.7 },
            });
        };

        function toggleAudio() {
            if (audioElement.paused) {
                audioElement.play();

                confettiInterval = setInterval(fireConfetti, 1800);  

                // Start image fade-in after a 20-second delay
                imageTimeout = setTimeout(() => {
                    imageInterval = setInterval(fadeInOutRandomImage, 3000);
                }, 10000);  // delay
            } else {
                audioElement.pause();

                // Stop confetti when paused
                clearInterval(confettiInterval);

                // Stop image fade-in effect
                clearInterval(imageInterval);
                clearTimeout(imageTimeout); 
            }
        }
        
        audioElement.addEventListener('ended', () => {
            clearInterval(confettiInterval);
            clearInterval(imageInterval);
            clearTimeout(imageTimeout);

            const fixedImage = document.createElement('img');
            fixedImage.src = 'images/mainImage.jpg';
            fixedImage.className = 'fixed-image';
            document.body.appendChild(fixedImage);

            setTimeout(() => {
                fixedImage.style.opacity = 1;
                fixedImage.style.zIndex = 500;
                cakejs.style.zIndex = 200;
            }, 100);
            
            endAudioElement.play();
            fireworks.start();
        });
    </script>

</body>
</html>